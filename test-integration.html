<!DOCTYPE html>
<html>
<head>
  <title>Integration Test - Advanced Features</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #1e40af;
      margin-bottom: 30px;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-item {
      padding: 12px;
      margin: 8px 0;
      border-left: 4px solid #ddd;
      background: #f9f9f9;
    }
    .test-item.pass {
      border-left-color: #10b981;
      background: #d1fae5;
    }
    .test-item.fail {
      border-left-color: #ef4444;
      background: #fee2e2;
    }
    .status {
      font-weight: bold;
      margin-right: 10px;
    }
    .pass .status { color: #10b981; }
    .fail .status { color: #ef4444; }
    button {
      background: #1e40af;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #1e3a8a;
    }
    #results {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>üß™ Advanced Features Integration Test</h1>

  <div class="test-section">
    <h2>Test Controls</h2>
    <button onclick="runTests()">Run All Tests</button>
    <button onclick="location.reload()">Reset</button>
  </div>

  <div id="results"></div>

  <!-- Load all scripts in same order as popup.html -->
  <script src="config.js"></script>
  <script src="chrome-ai.js"></script>
  <script src="argument-analyzer.js"></script>
  <script src="ai-comparison.js"></script>
  <script src="advanced-features.js"></script>
  <script src="popup-advanced-handlers.js"></script>

  <script>
    function runTests() {
      const results = [];

      // Test 1: Check all feature functions exist
      const requiredFunctions = [
        'analyzeArgumentStrength',
        'generateComparisonReplies',
        'formatComparisonDisplay',
        'analyzeSentiment',
        'analyzeToxicity',
        'generateDebateMode',
        'breakEchoChamber',
        'factCheckContent',
        'setupAdvancedFeatureListeners'
      ];

      requiredFunctions.forEach(funcName => {
        const exists = typeof window[funcName] === 'function';
        results.push({
          name: `Function: ${funcName}`,
          pass: exists,
          details: exists ? 'Function defined' : 'Function missing'
        });
      });

      // Test 2: Check Chrome AI functions
      const chromeAIFunctions = [
        'checkChromeAIAvailability',
        'generateRepliesWithChromeAI',
        'summarizeWithChromeAI'
      ];

      chromeAIFunctions.forEach(funcName => {
        const exists = typeof window[funcName] === 'function';
        results.push({
          name: `Chrome AI: ${funcName}`,
          pass: exists,
          details: exists ? 'Function defined' : 'Function missing'
        });
      });

      // Test 3: Check config is loaded
      results.push({
        name: 'Config loaded',
        pass: typeof CONFIG !== 'undefined',
        details: typeof CONFIG !== 'undefined' ? `API Key: ${CONFIG.GEMINI_API_KEY ? 'Set' : 'Missing'}` : 'CONFIG undefined'
      });

      // Display results
      displayResults(results);
    }

    function displayResults(results) {
      const container = document.getElementById('results');
      const passed = results.filter(r => r.pass).length;
      const total = results.length;

      let html = '<div class="test-section">';
      html += `<h2>Test Results: ${passed}/${total} Passed</h2>`;

      results.forEach(result => {
        html += `
          <div class="test-item ${result.pass ? 'pass' : 'fail'}">
            <span class="status">${result.pass ? '‚úÖ' : '‚ùå'}</span>
            <strong>${result.name}</strong>: ${result.details}
          </div>
        `;
      });

      html += '</div>';

      // Summary
      html += '<div class="test-section">';
      if (passed === total) {
        html += '<h2 style="color: #10b981;">‚úÖ All Tests Passed!</h2>';
        html += '<p>All advanced features are properly integrated and ready to test in the extension.</p>';
      } else {
        html += '<h2 style="color: #ef4444;">‚ùå Some Tests Failed</h2>';
        html += `<p>${total - passed} tests failed. Check the details above.</p>`;
      }
      html += '</div>';

      container.innerHTML = html;
    }

    // Auto-run tests on load
    window.addEventListener('load', () => {
      setTimeout(runTests, 500);
    });
  </script>
</body>
</html>
